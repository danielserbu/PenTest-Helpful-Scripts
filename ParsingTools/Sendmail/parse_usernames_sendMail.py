import re
import sys

def extract_usernames_and_emails_from_log(log_file_path, log_line_pattern, email_pattern):
    usernames = []
    emails = []

    with open(log_file_path, "r") as log_file:
        for line in log_file:
            log_line_match = re.search(log_line_pattern, line)
            if log_line_match:
                usernames.append(log_line_match.group(1))

            email_match = re.search(email_pattern, line)
            if email_match:
                emails.append(email_match.group(1))

    return usernames, emails

def write_to_file(file_path, data):
    with open(file_path, "w") as output_file:
        for item in data:
            output_file.write(f"{item}\n")

if __name__ == "__main__":
    if len(sys.argv) != 5:
        print("Usage: python parse_usernames_sendmail.py log_file_path log_line_pattern email_pattern usernames_output_file emails_output_file")
        sys.exit(1)

    log_file_path = sys.argv[1]
    log_line_pattern = sys.argv[2]
    email_pattern = sys.argv[3]
    usernames_output_file = sys.argv[4]
    emails_output_file = sys.argv[5]

    usernames, emails = extract_usernames_and_emails_from_log(log_file_path, log_line_pattern, email_pattern)

    write_to_file(usernames_output_file, usernames)
    print(f"Usernames found in the log file have been written to {usernames_output_file}")

    write_to_file(emails_output_file, emails)
    print(f"Emails found in the log file have been written to {emails_output_file}")

# Example
# python parse_usernames_sendmail.py sendmail.txt "\[\d+-\w+-\d+ \d+:\d+:\d+ \+\d+\]: User (\S+?)\[" "Message for (\S+@\S+);" usernames.txt emails.txt
