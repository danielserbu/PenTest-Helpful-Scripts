import argparse
import csv
import socket

parser = argparse.ArgumentParser(description="Find Alive Hosts from addresses file.")
parser.add_argument("-iF", "--addressesFile", help="addresses file (separated by new line")
args = parser.parse_args()
addressesFile = args.addressesFile

alive_output_file = "aliveHosts.txt"
alive_hosts = []
down_output_file = "downHosts.txt"
down_hosts = []

def is_host_alive(host, port):
    try:
        s = socket.create_connection((host, port), timeout=1)
        s.close()
        return True
    except socket.error:
        return False

with open(addressesFile, 'r') as file:
    reader = csv.DictReader(file)
    for row in reader:
        address = row['address']
        port = row['port']
        status = is_host_alive(address, port)
        if status:
            print("Host " + address + " is alive on port " + port)
            alive_hosts.append(address)
        else:
            print("Host " + address + " is down on port " + port)
            down_hosts.append(address)

with open(alive_output_file, "w") as file:
    for alive_host in alive_hosts:
        file.writelines(alive_host + '\n')

with open(down_output_file, "w") as file:
    for down_host in down_hosts:
        file.writelines(down_host + '\n')